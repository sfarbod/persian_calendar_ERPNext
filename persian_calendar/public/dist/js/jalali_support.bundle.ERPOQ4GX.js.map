{
  "version": 3,
  "sources": ["../../../../../apps/persian_calendar/persian_calendar/public/js/jalali_support/jalaali.js", "../../../../../apps/persian_calendar/persian_calendar/public/js/jalali_support/persian_calendar.js", "../../../../../apps/persian_calendar/persian_calendar/public/js/jalali_support/formatters.js", "../../../../../apps/persian_calendar/persian_calendar/public/js/jalali_support/auto_refresh.js"],
  "sourcesContent": ["(function(){\n  // Use Intl.DateTimeFormat with Persian calendar to derive reliable Jalali parts\n  // Force Latin digits by using en locale with u-ca-persian\n  const fmt = new Intl.DateTimeFormat('en-u-ca-persian', { year:'numeric', month:'2-digit', day:'2-digit'});\n  function toJalaliPartsFromGregorianDate(gDate){\n    const parts = fmt.formatToParts(gDate);\n    const map = Object.fromEntries(parts.map(p=>[p.type,p.value]));\n    const jy = parseInt(map.year, 10);\n    const jm = parseInt(map.month, 10);\n    const jd = parseInt(map.day, 10);\n    return { jy, jm, jd };\n  }\n  function toJalali(gy,gm,gd){\n    return toJalaliPartsFromGregorianDate(new Date(gy, gm-1, gd));\n  }\n\n  // Simple but accurate Jalali to Gregorian conversion\n  function toGregorian(jy, jm, jd) {\n    // Use a more direct approach with Intl.DateTimeFormat\n    // Create a date range and find the exact match\n    const startYear = 2000;\n    const endYear = 2030;\n    \n    for (let year = startYear; year <= endYear; year++) {\n      for (let month = 1; month <= 12; month++) {\n        for (let day = 1; day <= 31; day++) {\n          try {\n            const testDate = new Date(year, month - 1, day);\n            if (testDate.getFullYear() !== year || testDate.getMonth() !== month - 1 || testDate.getDate() !== day) {\n              continue; // Skip invalid dates\n            }\n            \n            const testJalali = toJalaliPartsFromGregorianDate(testDate);\n            \n            if (testJalali.jy === jy && testJalali.jm === jm && testJalali.jd === jd) {\n              return {\n                gy: year,\n                gm: month,\n                gd: day\n              };\n            }\n          } catch (e) {\n            // Skip invalid dates\n            continue;\n          }\n        }\n      }\n    }\n    \n    // If no exact match found, use a more sophisticated fallback\n    // Calculate approximate Gregorian date\n    const jalaliEpoch = new Date(622, 2, 22); // March 22, 622 AD (Jalali year 1)\n    const daysSinceEpoch = (jy - 1) * 365 + (jm - 1) * 30 + (jd - 1);\n    const approximateDate = new Date(jalaliEpoch.getTime() + daysSinceEpoch * 24 * 60 * 60 * 1000);\n    \n    return {\n      gy: approximateDate.getFullYear(),\n      gm: approximateDate.getMonth() + 1,\n      gd: approximateDate.getDate()\n    };\n  }\n\n  // Expose helpers\n  window.toJalali = toJalali;\n  window.toGregorian = toGregorian;\n  window.toJalaliPartsFromGregorianDate = toJalaliPartsFromGregorianDate;\n})();\n\n\n", "(async function() {\n  frappe.provide(\"frappe.ui.form\");\n\n  console.log(\"jalali_support script loaded\");\n\n  // Check if Jalali calendar is enabled\n  let jalaliEnabled = false;\n  try {\n    const result = await frappe.call({ method: \"persian_calendar.jalali_support.api.is_jalali_enabled\" });\n    jalaliEnabled = result && result.message;\n    console.log(\"Jalali calendar enabled:\", jalaliEnabled);\n  } catch(e) {\n    console.log(\"Error checking Jalali settings:\", e);\n    jalaliEnabled = false;\n  }\n\n  if (!jalaliEnabled) {\n    console.log(\"Jalali calendar is disabled, skipping datepicker overrides\");\n    return;\n  }\n\n  // Get effective calendar settings\n  let EFFECTIVE_CALENDAR = {\n    display_calendar: \"Jalali\",\n    week_start: 6,\n    week_end: 5\n  };\n  \n  try {\n    const r = await frappe.call({ method: \"persian_calendar.jalali_support.api.get_effective_calendar\" });\n    if (r && r.message) {\n      EFFECTIVE_CALENDAR = r.message;\n      console.log(\"Effective calendar settings:\", EFFECTIVE_CALENDAR);\n    }\n  } catch(e) {\n    console.log(\"Error fetching effective calendar:\", e);\n  }\n\n  // Legacy FIRST_DAY for backward compatibility\n  let FIRST_DAY = EFFECTIVE_CALENDAR.week_start || 6;\n\n  // Helper functions\n  function gToJ(gDate) {\n    return toJalali(gDate.getFullYear(), gDate.getMonth() + 1, gDate.getDate());\n  }\n\n  function jToG(jy, jm, jd) {\n    return toGregorian(jy, jm, jd);\n  }\n\n  function formatJalaliDate(jy, jm, jd) {\n    return `${jy}-${String(jm).padStart(2,\"0\")}-${String(jd).padStart(2,\"0\")}`;\n  }\n\n  function parseJalaliDate(dateStr) {\n    const parts = dateStr.split('-').map(Number);\n    if (parts.length !== 3) return null;\n    return { jy: parts[0], jm: parts[1], jd: parts[2] };\n  }\n\n// Global function to close all Jalali datepickers\nfunction closeAllJalaliDatepickers() {\n  $('.jalali-datepicker').each(function() {\n    const $calendar = $(this);\n    const instance = $calendar.data('jalaliDatepickerInstance');\n    if (instance && instance.isOpen) {\n      instance.close(); // Call the instance's close method to clean up its listeners\n    } else {\n      $calendar.hide(); // Fallback if instance not found or not open\n    }\n  });\n  \n  // No need to remove global handlers here if each instance manages its own\n  // The keydown handler is now instance-specific, so no global off needed here.\n  \n  console.log('All Jalali datepickers closed');\n}\n\n// Enhanced Jalali Datepicker Class\nclass JalaliDatepicker {\n    constructor(input, controlDate = null) {\n      this.input = input;\n      this.$input = $(input);\n      this.controlDate = controlDate;\n      this.isOpen = false;\n      this.currentDate = gToJ(new Date());\n      this.selectedDate = null;\n      this.view = 'days'; // 'days', 'months', 'years'\n      this.yearRange = { start: 1400, end: 1410 };\n      \n      this.init();\n    }\n\n    init() {\n      this.createCalendar();\n      this.bindEvents();\n      this.updateDisplay();\n      this.fixAlignment();\n      this.$calendar.data('jalaliDatepickerInstance', this); // Store instance\n    }\n    \n    fixAlignment() {\n      // Ensure input field alignment matches other form fields using exact Frappe CSS variables\n      const $input = this.$input;\n      const $wrapper = $input.closest('.form-group, .frappe-control');\n      const $formColumn = $input.closest('.form-column');\n      \n      if ($wrapper.length) {\n        // Reset wrapper styles to match Frappe defaults with higher specificity\n        $wrapper.css({\n          'margin-bottom': '0 !important',\n          'padding': '0 !important',\n          'vertical-align': 'top !important',\n          'display': 'block !important',\n          'position': 'relative !important',\n          'align-items': 'flex-start !important'\n        });\n        \n        // Apply exact Frappe form control styling with higher specificity - match Gregorian exactly\n        $input.css({\n          'height': '28px !important', // Exact height like Gregorian\n          'line-height': '28px !important', // Exact line-height like Gregorian\n          'padding': '6px 8px !important', // Exact padding like Gregorian\n          'margin': '0 !important',\n          'vertical-align': 'top !important',\n          'box-sizing': 'border-box !important',\n          'background-color': '#fff !important', // Exact background like Gregorian\n          'border': '1px solid #d1d8dd !important', // Exact border like Gregorian\n          'border-radius': '4px !important', // Exact border-radius like Gregorian\n          'font-size': '13px !important', // Exact font-size like Gregorian\n          'font-weight': 'normal !important', // Exact font-weight like Gregorian\n          'color': '#36414c !important', // Exact color like Gregorian\n          'position': 'relative !important',\n          'z-index': '1 !important',\n          'display': 'block !important',\n          'width': '100% !important',\n          'font-family': '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif !important' // Exact font-family like Gregorian\n        });\n        \n        // Ensure the input container has proper positioning\n        const $inputContainer = $input.closest('.control-input, .form-control-wrapper');\n        if ($inputContainer.length) {\n          $inputContainer.css({\n            'position': 'relative !important',\n            'display': 'block !important',\n            'margin': '0 !important',\n            'padding': '0 !important',\n            'vertical-align': 'top !important',\n            'align-items': 'flex-start !important'\n          });\n        }\n        \n        // Ensure form column alignment with higher specificity\n        if ($formColumn.length) {\n          $formColumn.css({\n            'vertical-align': 'top !important',\n            'display': 'flex !important',\n            'flex-direction': 'column !important',\n            'margin': '0 !important',\n            'padding': '0 !important',\n            'align-items': 'stretch !important',\n            'justify-content': 'flex-start !important'\n          });\n        }\n        \n        // Target the specific form section to ensure proper alignment\n        const $formSection = $input.closest('.form-section');\n        if ($formSection.length) {\n          $formSection.css({\n            'display': 'flex !important',\n            'flex-direction': 'row !important',\n            'align-items': 'flex-start !important'\n          });\n        }\n        \n        // Ensure the datepicker doesn't affect layout\n        if (this.$calendar && this.$calendar.length) {\n          this.$calendar.css({\n            'position': 'absolute !important',\n            'z-index': '9999 !important',\n            'margin': '0 !important',\n            'padding': '0 !important'\n          });\n        }\n      }\n    }\n\n    createCalendar() {\n      // Remove existing calendar\n      this.$input.siblings('.jalali-datepicker').remove();\n      \n      // Create calendar HTML with exact Gregorian styling\n      const calendarHTML = `\n        <div class=\"jalali-datepicker\" style=\"\n          position: absolute;\n          top: 100%;\n          left: 0;\n          background: var(--bg-color, #fff);\n          border: 1px solid var(--border-color, #d1d8dd);\n          border-radius: var(--border-radius-sm, 6px);\n          box-shadow: var(--shadow-md, 0 2px 8px rgba(0,0,0,0.15));\n          z-index: 1000;\n          display: none;\n          width: 210px;\n          padding: 1px;\n          font-family: var(--font-stack, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);\n          font-size: var(--text-sm, 13px);\n          margin-top: 1px;\n        \">\n          <!-- Header with Navigation -->\n          <div class=\"calendar-header\" style=\"\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 1px;\n            padding-bottom: 1px;\n            border-bottom: 1px solid var(--border-color, #e5e7eb);\n          \">\n            <button type=\"button\" class=\"nav-btn prev-btn\" style=\"\n              background: transparent;\n              border: none;\n              cursor: pointer;\n              padding: 1px 3px;\n              font-size: 11px;\n              color: var(--text-light, #6c7b7f);\n              transition: color 0.2s ease;\n              border-radius: 4px;\n            \">\u2039</button>\n            <button type=\"button\" class=\"nav-btn prev-decade\" style=\"\n              background: transparent;\n              border: none;\n              cursor: pointer;\n              padding: 1px 3px;\n              font-size: 11px;\n              color: #6c7b7f;\n              transition: color 0.2s ease;\n              border-radius: 4px;\n            \">\u2039\u2039</button>\n            <span class=\"month-year clickable\" style=\"\n              font-weight: 500;\n              font-size: 12px;\n              cursor: pointer;\n              padding: 1px 4px;\n              color: var(--text-color, #36414c);\n              transition: background-color 0.2s ease;\n              border-radius: 4px;\n            \"></span>\n            <button type=\"button\" class=\"nav-btn next-decade\" style=\"\n              background: transparent;\n              border: none;\n              cursor: pointer;\n              padding: 1px 3px;\n              font-size: 11px;\n              color: #6c7b7f;\n              transition: color 0.2s ease;\n              border-radius: 4px;\n            \">\u203A\u203A</button>\n            <button type=\"button\" class=\"nav-btn next-btn\" style=\"\n              background: transparent;\n              border: none;\n              cursor: pointer;\n              padding: 1px 3px;\n              font-size: 11px;\n              color: #6c7b7f;\n              transition: color 0.2s ease;\n              border-radius: 4px;\n            \">\u203A</button>\n          </div>\n          \n          <!-- Content Area -->\n          <div class=\"calendar-content\">\n            <!-- Days View -->\n            <div class=\"days-view\">\n              <div class=\"weekdays\" style=\"\n                display: grid;\n                grid-template-columns: repeat(7, 30px);\n                gap: 0px;\n                margin-bottom: 0px;\n              \"></div>\n              <div class=\"days-grid\" style=\"\n                display: grid;\n                grid-template-columns: repeat(7, 30px);\n                gap: 0px;\n              \"></div>\n            </div>\n            \n            <!-- Months View -->\n            <div class=\"months-view\" style=\"display: none;\">\n              <div class=\"months-grid\" style=\"\n                display: grid;\n                grid-template-columns: repeat(3, 1fr);\n                gap: 1px;\n                padding: 1px 0;\n              \"></div>\n            </div>\n            \n            <!-- Years View -->\n            <div class=\"years-view\" style=\"display: none;\">\n              <div class=\"years-grid\" style=\"\n                display: grid;\n                grid-template-columns: repeat(4, 1fr);\n                gap: 1px;\n                padding: 1px 0;\n              \"></div>\n            </div>\n          </div>\n          \n          <!-- Footer -->\n          <div class=\"calendar-footer\" style=\"\n            margin-top: 1px;\n            padding-top: 1px;\n            border-top: 1px solid var(--border-color, #eee);\n            text-align: center;\n          \">\n            <button type=\"button\" class=\"today-btn\" style=\"\n              background: transparent;\n              color: var(--text-color, #36414c);\n              border: 1px solid var(--border-color, #d1d8dd);\n              padding: 2px 8px;\n              border-radius: 3px;\n              cursor: pointer;\n              font-size: 12px;\n              font-weight: normal;\n              transition: all 0.2s ease;\n              font-family: var(--font-stack, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);\n              width: 100%;\n            \">\u0627\u0645\u0631\u0648\u0632</button>\n          </div>\n        </div>\n      `;\n      \n      this.$calendar = $(calendarHTML);\n      this.$input.after(this.$calendar);\n      \n      console.log(\"Jalali datepicker created\");\n    }\n\n    bindEvents() {\n      const self = this;\n      \n      // Input click\n      this.$input.on('click', function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        self.toggle();\n      });\n      \n      // Month/Year navigation\n      this.$calendar.find('.prev-btn').on('click', function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        self.navigateMonth(-1);\n      });\n      \n      this.$calendar.find('.next-btn').on('click', function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        self.navigateMonth(1);\n      });\n      \n      // Month/Year click to switch views\n      this.$calendar.find('.month-year').on('click', function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        \n        // Switch views based on current view\n        if (self.view === 'days') {\n          self.showMonthsView();\n        } else if (self.view === 'months') {\n          self.showYearsView();\n        } else if (self.view === 'years') {\n          self.showMonthsView();\n        }\n      });\n      \n      // Year navigation\n      this.$calendar.find('.prev-decade').on('click', function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        self.navigateYear(-10);\n      });\n      \n      this.$calendar.find('.next-decade').on('click', function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        self.navigateYear(10);\n      });\n      \n      // Today button\n      this.$calendar.find('.today-btn').on('click', function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        self.selectToday();\n      });\n      \n      // Simple click outside to close\n      $(document).on('click.jalali-datepicker-global', function(e) {\n        if (self.isOpen) {\n          const $target = $(e.target);\n          // Close if clicking outside the datepicker and not on the input field\n          if (!$target.closest('.jalali-datepicker').length && \n              !$target.is(self.input)) {\n            console.log('Closing datepicker due to click outside');\n            self.close();\n          }\n        }\n      });\n      \n      // Close when clicking on any date input field\n      $(document).on('click.jalali-datepicker-date-inputs', function(e) {\n        if (self.isOpen) {\n          const $target = $(e.target);\n          // Close if clicking on any date input field that's not our current input\n          if ($target.is('input[data-fieldtype=\"Date\"]') && \n              !$target.is(self.input)) {\n            console.log('Closing datepicker due to click on another date field');\n            self.close();\n          }\n        }\n      });\n      \n      // ESC key to close - make it instance specific\n      this._keydownHandler = function(e) {\n        if (e.keyCode === 27 && self.isOpen) { // ESC\n          self.close();\n        }\n      };\n      $(document).on('keydown.jalali-datepicker-' + (this.input.id || 'default'), this._keydownHandler);\n\n      // Use native event listener for capturing phase to ensure clicks outside are caught\n      // This is more robust against e.stopPropagation() from other elements\n      this._globalClickListener = function(e) {\n        if (self.isOpen) {\n          const $target = $(e.target);\n          const isClickInsideDatepicker = $target.closest('.jalali-datepicker').length > 0;\n          const isClickOnOwnInput = $target.is(self.input);\n\n          if (!isClickInsideDatepicker && !isClickOnOwnInput) {\n            console.log('Capturing phase: Closing datepicker due to click outside (general)');\n            self.close();\n          }\n        }\n      };\n      document.addEventListener('click', this._globalClickListener, true); // true for capturing phase\n      \n      // Add hover effects\n      this.$calendar.find('.nav-btn').hover(\n        function() { $(this).css('background-color', '#f8f9fa'); },\n        function() { $(this).css('background-color', 'transparent'); }\n      );\n      \n      this.$calendar.find('.month-year').hover(\n        function() { $(this).css('background-color', '#f8f9fa'); },\n        function() { $(this).css('background-color', 'transparent'); }\n      );\n    }\n\n    toggle() {\n      if (this.isOpen) {\n        this.close();\n      } else {\n        // Always reset to days view when opening\n        this.view = 'days';\n        this.open();\n      }\n    }\n\n    open() {\n      // Close all other Jalali datepickers first\n      closeAllJalaliDatepickers();\n      \n      this.isOpen = true;\n      this.view = 'days'; // Always reset to days view\n      this.updateDisplay(); // Update display to show current date\n      this.updateCalendar();\n      this.$calendar.show();\n      console.log(\"Calendar opened with view:\", this.view);\n    }\n\n    close() {\n      this.isOpen = false;\n      this.$calendar.hide();\n      \n      // Remove event handlers to prevent memory leaks\n      if (this._keydownHandler) {\n        $(document).off('keydown.jalali-datepicker-' + (this.input.id || 'default'), this._keydownHandler);\n        this._keydownHandler = null;\n      }\n      if (this._globalClickListener) {\n        document.removeEventListener('click', this._globalClickListener, true);\n        this._globalClickListener = null;\n      }\n      \n      console.log(\"Calendar closed\");\n    }\n    \n    // Navigation methods\n    navigateMonth(direction) {\n      if (this.view === 'days') {\n        this.currentDate.jm += direction;\n        if (this.currentDate.jm > 12) {\n          this.currentDate.jm = 1;\n          this.currentDate.jy++;\n        } else if (this.currentDate.jm < 1) {\n          this.currentDate.jm = 12;\n          this.currentDate.jy--;\n        }\n        this.updateCalendar();\n      } else if (this.view === 'months') {\n        // In months view, navigate year by year\n        this.currentDate.jy += direction;\n        this.updateMonthsView();\n      }\n    }\n    \n    navigateYear(direction) {\n      // Navigate by decade (like Gregorian calendar)\n      this.yearRange.start += direction;\n      this.yearRange.end += direction;\n      \n      // Update current year to center of new range\n      this.currentDate.jy = this.yearRange.start + 4; // Middle of decade\n      \n      this.updateYearsView();\n    }\n    \n    // View switching methods\n    showMonthsView() {\n      this.view = 'months';\n      this.updateMonthsView();\n      this.$calendar.find('.days-view').hide();\n      this.$calendar.find('.years-view').hide();\n      this.$calendar.find('.months-view').show();\n    }\n    \n    showYearsView() {\n      this.view = 'years';\n      this.updateYearsView();\n      this.$calendar.find('.days-view').hide();\n      this.$calendar.find('.months-view').hide();\n      this.$calendar.find('.years-view').show();\n    }\n    \n    showDaysView() {\n      this.view = 'days';\n      this.updateCalendar();\n      this.$calendar.find('.months-view').hide();\n      this.$calendar.find('.years-view').hide();\n      this.$calendar.find('.days-view').show();\n    }\n\n    updateCalendar() {\n      const monthNames = ['\u0641\u0631\u0648\u0631\u062F\u06CC\u0646', '\u0627\u0631\u062F\u06CC\u0628\u0647\u0634\u062A', '\u062E\u0631\u062F\u0627\u062F', '\u062A\u06CC\u0631', '\u0645\u0631\u062F\u0627\u062F', '\u0634\u0647\u0631\u06CC\u0648\u0631', \n                        '\u0645\u0647\u0631', '\u0622\u0628\u0627\u0646', '\u0622\u0630\u0631', '\u062F\u06CC', '\u0628\u0647\u0645\u0646', '\u0627\u0633\u0641\u0646\u062F'];\n      \n      // Update header\n      this.$calendar.find('.month-year').text(`${monthNames[this.currentDate.jm - 1]} ${this.currentDate.jy}`);\n      \n      // Show/hide navigation buttons\n      this.$calendar.find('.prev-btn, .next-btn').show();\n      this.$calendar.find('.prev-decade, .next-decade').hide();\n      \n      // Hide all views first\n      this.$calendar.find('.days-view').hide();\n      this.$calendar.find('.months-view').hide();\n      this.$calendar.find('.years-view').hide();\n      \n      // Show only the current view\n      if (this.view === 'days') {\n        this.$calendar.find('.days-view').show();\n        // Update weekdays based on FIRST_DAY\n        this.updateWeekdays();\n        // Update days\n        this.updateDays();\n      } else if (this.view === 'months') {\n        this.$calendar.find('.months-view').show();\n        this.updateMonthsView();\n      } else if (this.view === 'years') {\n        this.$calendar.find('.years-view').show();\n        this.updateYearsView();\n      }\n    }\n    \n    updateWeekdays() {\n      // \u062A\u0631\u062A\u06CC\u0628 \u0635\u062D\u06CC\u062D \u0631\u0648\u0632\u0647\u0627\u06CC \u0647\u0641\u062A\u0647 \u0628\u0631 \u0627\u0633\u0627\u0633 \u062A\u0646\u0638\u06CC\u0645\u0627\u062A: \u0634\u0646\u0628\u0647=6, \u06CC\u06A9\u0634\u0646\u0628\u0647=0, \u062F\u0648\u0634\u0646\u0628\u0647=1, \u0633\u0647\u200C\u0634\u0646\u0628\u0647=2, \u0686\u0647\u0627\u0631\u0634\u0646\u0628\u0647=3, \u067E\u0646\u062C\u200C\u0634\u0646\u0628\u0647=4, \u062C\u0645\u0639\u0647=5\n      const weekdayNames = ['\u06CC', '\u062F', '\u0633', '\u0686', '\u067E', '\u062C', '\u0634']; // [\u06CC\u06A9\u0634\u0646\u0628\u0647, \u062F\u0648\u0634\u0646\u0628\u0647, \u0633\u0647\u200C\u0634\u0646\u0628\u0647, \u0686\u0647\u0627\u0631\u0634\u0646\u0628\u0647, \u067E\u0646\u062C\u200C\u0634\u0646\u0628\u0647, \u062C\u0645\u0639\u0647, \u0634\u0646\u0628\u0647]\n      const $weekdaysContainer = this.$calendar.find('.weekdays');\n      $weekdaysContainer.empty();\n      \n      // \u0628\u0627 \u062A\u0648\u062C\u0647 \u0628\u0647 FIRST_DAY = 6 (\u0634\u0646\u0628\u0647)\u060C \u062A\u0631\u062A\u06CC\u0628 \u0646\u0645\u0627\u06CC\u0634 \u0628\u0627\u06CC\u062F: \u0634\u0646\u0628\u0647, \u06CC\u06A9\u0634\u0646\u0628\u0647, \u062F\u0648\u0634\u0646\u0628\u0647, \u0633\u0647\u200C\u0634\u0646\u0628\u0647, \u0686\u0647\u0627\u0631\u0634\u0646\u0628\u0647, \u067E\u0646\u062C\u200C\u0634\u0646\u0628\u0647, \u062C\u0645\u0639\u0647\n      for (let i = 0; i < 7; i++) {\n        const dayIndex = (FIRST_DAY + i) % 7;\n        $weekdaysContainer.append($(`<div class=\"weekday\" style=\"text-align: center; padding: 0; font-weight: 500; font-size: 9px; color: var(--text-light, #7c7c7c); font-family: var(--font-stack, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif); width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;\">${weekdayNames[dayIndex]}</div>`));\n      }\n    }\n\n    updateDays() {\n      const $daysGrid = this.$calendar.find('.days-grid');\n      $daysGrid.empty();\n      \n      const daysInMonth = this.currentDate.jm <= 6 ? 31 : \n                         (this.currentDate.jm <= 11 ? 30 : \n                         (this.currentDate.jy % 4 === 3 ? 30 : 29));\n      \n      // Get first day of month (Saturday = 0)\n      const firstDay = this.getFirstDayOfMonth(this.currentDate.jy, this.currentDate.jm);\n      \n      // Calculate previous month's last days\n      let prevMonth = this.currentDate.jm - 1;\n      let prevYear = this.currentDate.jy;\n      if (prevMonth < 1) {\n        prevMonth = 12;\n        prevYear--;\n      }\n      const prevMonthDays = prevMonth <= 6 ? 31 : \n                           (prevMonth <= 11 ? 30 : \n                           (prevYear % 4 === 3 ? 30 : 29));\n      \n      // Add previous month's last days (light color, selectable)\n      for (let i = firstDay - 1; i >= 0; i--) {\n        const day = prevMonthDays - i;\n        const $prevDay = $(`<div class=\"day-cell prev-month-day\" data-day=\"${day}\" data-month=\"${prevMonth}\" data-year=\"${prevYear}\" style=\"\n          text-align: center;\n          padding: 0;\n          cursor: pointer;\n          border-radius: 0;\n          transition: all 0.2s ease;\n          font-size: 11px;\n          color: var(--text-light, #999);\n          width: 30px;\n          height: 30px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-family: var(--font-stack, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);\n          border: none;\n          background: transparent;\n        \">${day}</div>`);\n        \n        // Add click handler for previous month days - select the day directly\n        $prevDay.on('click', (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          this.currentDate.jy = prevYear;\n          this.currentDate.jm = prevMonth;\n          this.currentDate.jd = day;\n          this.selectDate(day);\n        });\n        \n        // Add hover effect\n        $prevDay.hover(\n          function() { $(this).css('background-color', '#f8f9fa'); },\n          function() { $(this).css('background-color', 'transparent'); }\n        );\n        \n        $daysGrid.append($prevDay);\n      }\n      \n      for (let day = 1; day <= daysInMonth; day++) {\n        const $day = $(`<div class=\"day-cell\" data-day=\"${day}\" style=\"\n          text-align: center;\n          padding: 0;\n          cursor: pointer;\n          border-radius: 0;\n          transition: all 0.2s ease;\n          font-size: 11px;\n          color: var(--text-color, #36414c);\n          width: 30px;\n          height: 30px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-family: var(--font-stack, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);\n          border: none;\n          background: transparent;\n        \">${day}</div>`);\n        \n        // Add click handler\n        $day.on('click', (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          this.selectDate(day);\n        });\n        \n        // Add hover effects\n        $day.hover(\n          function() { \n            if (!$(this).hasClass('selected') && !$(this).hasClass('today')) {\n              $(this).css('background-color', '#f8f9fa');\n            }\n          },\n          function() { \n            if (!$(this).hasClass('selected') && !$(this).hasClass('today')) {\n              $(this).css('background-color', 'transparent');\n            }\n          }\n        );\n        \n        // Highlight today (gray background like Gregorian)\n        const today = gToJ(new Date());\n        if (this.currentDate.jy === today.jy && \n            this.currentDate.jm === today.jm && \n            day === today.jd) {\n          $day.addClass('today').css({\n            'background-color': 'var(--control-bg, #f3f3f3)',\n            'color': 'var(--text-color, #36414c)',\n            'font-weight': 'bold'\n          });\n        }\n        \n        // Highlight selected day (black background like Gregorian)\n        if (this.selectedDate && \n            this.selectedDate.jy === this.currentDate.jy &&\n            this.selectedDate.jm === this.currentDate.jm &&\n            this.selectedDate.jd === day) {\n          $day.addClass('selected').css({\n            'background-color': 'var(--primary, #171717)',\n            'color': 'var(--bg-color, white)',\n            'font-weight': 'bold'\n          });\n        }\n        \n        $daysGrid.append($day);\n      }\n      \n      // Calculate next month's first days\n      let nextMonth = this.currentDate.jm + 1;\n      let nextYear = this.currentDate.jy;\n      if (nextMonth > 12) {\n        nextMonth = 1;\n        nextYear++;\n      }\n      \n      // Calculate how many cells we need to fill to complete the grid (6 rows = 42 cells)\n      const totalCells = 42; // 6 rows * 7 days\n      const currentCells = firstDay + daysInMonth;\n      const remainingCells = totalCells - currentCells;\n      \n      // Add next month's first days (light color, selectable)\n      for (let day = 1; day <= remainingCells; day++) {\n        const $nextDay = $(`<div class=\"day-cell next-month-day\" data-day=\"${day}\" data-month=\"${nextMonth}\" data-year=\"${nextYear}\" style=\"\n          text-align: center;\n          padding: 0;\n          cursor: pointer;\n          border-radius: 0;\n          transition: all 0.2s ease;\n          font-size: 11px;\n          color: var(--text-light, #999);\n          width: 30px;\n          height: 30px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-family: var(--font-stack, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);\n          border: none;\n          background: transparent;\n        \">${day}</div>`);\n        \n        // Add click handler for next month days - select the day directly\n        $nextDay.on('click', (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          this.currentDate.jy = nextYear;\n          this.currentDate.jm = nextMonth;\n          this.currentDate.jd = day;\n          this.selectDate(day);\n        });\n        \n        // Add hover effect\n        $nextDay.hover(\n          function() { $(this).css('background-color', '#f8f9fa'); },\n          function() { $(this).css('background-color', 'transparent'); }\n        );\n        \n        $daysGrid.append($nextDay);\n      }\n      \n      console.log(`Updated calendar with ${daysInMonth} days`);\n    }\n\n    selectDate(day) {\n      this.selectedDate = {\n        jy: this.currentDate.jy,\n        jm: this.currentDate.jm,\n        jd: day\n      };\n      \n      const jalaliStr = formatJalaliDate(this.selectedDate.jy, this.selectedDate.jm, this.selectedDate.jd);\n      \n      // Convert to Gregorian for storage\n      const gregorian = jToG(this.selectedDate.jy, this.selectedDate.jm, this.selectedDate.jd);\n      const gregorianStr = `${gregorian.gy}-${String(gregorian.gm).padStart(2, '0')}-${String(gregorian.gd).padStart(2, '0')}`;\n      \n      console.log(`Converting Jalali ${jalaliStr} to Gregorian ${gregorianStr}`);\n      \n      // Set the Gregorian value in Frappe's system\n      if (this.controlDate && this.controlDate.set_value) {\n        this.controlDate.set_value(gregorianStr);\n        this.$input.val(jalaliStr);\n      } else {\n        // Fallback: just set the input value\n        this.$input.val(jalaliStr);\n        this.$input.trigger('change');\n      }\n      \n      this.close();\n      console.log(`Selected date: ${jalaliStr} (${gregorianStr})`);\n    }\n\n    selectToday() {\n      const today = gToJ(new Date());\n      console.log('Today in Jalali:', today);\n      \n      // Update current date to today's month/year\n      this.currentDate = { ...today };\n      \n      // Switch to days view to show the calendar properly\n      this.view = 'days';\n      \n      // Update calendar display\n      this.updateCalendar();\n      \n      // Select today's date\n      this.selectDate(today.jd);\n    }\n\n    prevMonth() {\n      if (this.currentDate.jm === 1) {\n        this.currentDate.jm = 12;\n        this.currentDate.jy--;\n      } else {\n        this.currentDate.jm--;\n      }\n      this.updateCalendar();\n    }\n\n    nextMonth() {\n      if (this.currentDate.jm === 12) {\n        this.currentDate.jm = 1;\n        this.currentDate.jy++;\n      } else {\n        this.currentDate.jm++;\n      }\n      this.updateCalendar();\n    }\n\n    updateDisplay() {\n      const value = this.$input.val();\n      if (value) {\n        const jalali = parseJalaliDate(value);\n        if (jalali) {\n          this.selectedDate = jalali;\n          this.currentDate = { ...jalali };\n        }\n      }\n      \n      // Always reset to days view when updating display\n      this.view = 'days';\n    }\n    \n    // Month/Year view methods\n    updateMonthsView() {\n      // Update header to show only year\n      this.$calendar.find('.month-year').text(`${this.currentDate.jy}`);\n      \n      // Hide/show navigation buttons - use year-by-year navigation for months view\n      this.$calendar.find('.prev-btn, .next-btn').show();\n      this.$calendar.find('.prev-decade, .next-decade').hide();\n      \n      const monthNames = ['\u0641\u0631\u0648\u0631\u062F\u06CC\u0646', '\u0627\u0631\u062F\u06CC\u0628\u0647\u0634\u062A', '\u062E\u0631\u062F\u0627\u062F', '\u062A\u06CC\u0631', '\u0645\u0631\u062F\u0627\u062F', '\u0634\u0647\u0631\u06CC\u0648\u0631', \n                        '\u0645\u0647\u0631', '\u0622\u0628\u0627\u0646', '\u0622\u0630\u0631', '\u062F\u06CC', '\u0628\u0647\u0645\u0646', '\u0627\u0633\u0641\u0646\u062F'];\n      \n      const $monthsGrid = this.$calendar.find('.months-grid');\n      $monthsGrid.empty();\n      \n      monthNames.forEach((month, index) => {\n        const $month = $(`<div class=\"month-cell\" data-month=\"${index + 1}\" style=\"\n          text-align: center;\n          padding: 3px 2px;\n          cursor: pointer;\n          border-radius: 0;\n          transition: all 0.2s ease;\n          font-size: 11px;\n          color: var(--text-color, #36414c);\n          border: 1px solid var(--border-color, #e2e2e2);\n          font-family: var(--font-stack, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);\n          background: transparent;\n        \">${month}</div>`);\n        \n        // Add click handler\n        $month.on('click', (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          this.currentDate.jm = index + 1;\n          this.showDaysView();\n        });\n        \n        // Add hover effects\n        $month.hover(\n          function() { \n            if (!$(this).hasClass('selected')) {\n              $(this).css('background-color', '#f8f9fa');\n            }\n          },\n          function() { \n            if (!$(this).hasClass('selected')) {\n              $(this).css('background-color', 'transparent');\n            }\n          }\n        );\n        \n        // Check if current month - use site theme colors like Gregorian\n        if (this.currentDate.jm === index + 1) {\n          $month.addClass('selected').css({\n            'background-color': 'var(--primary, #171717)',\n            'color': 'var(--bg-color, white)',\n            'font-weight': 'bold'\n          });\n        }\n        \n        $monthsGrid.append($month);\n      });\n    }\n    \n    updateYearsView() {\n      // Calculate year range centered around current year (like Gregorian calendar)\n      const currentYear = this.currentDate.jy;\n      const startYear = Math.floor(currentYear / 10) * 10; // Round down to decade\n      const endYear = startYear + 9;\n      \n      // Update yearRange for navigation\n      this.yearRange = { start: startYear, end: endYear };\n      \n      // Update header to show year range\n      this.$calendar.find('.month-year').text(`${this.yearRange.start} - ${this.yearRange.end}`);\n      \n      // Hide/show navigation buttons\n      this.$calendar.find('.prev-btn, .next-btn').hide();\n      this.$calendar.find('.prev-decade, .next-decade').show();\n      \n      const $yearsGrid = this.$calendar.find('.years-grid');\n      $yearsGrid.empty();\n      \n      // Show years from startYear-1 to endYear+1 (like Gregorian calendar)\n      for (let year = startYear - 1; year <= endYear + 1; year++) {\n        const $year = $(`<div class=\"year-cell\" data-year=\"${year}\" style=\"\n          text-align: center;\n          padding: 3px 2px;\n          cursor: pointer;\n          border-radius: 0;\n          transition: all 0.2s ease;\n          font-size: 11px;\n          color: var(--text-color, #36414c);\n          border: 1px solid var(--border-color, #e2e2e2);\n          font-family: var(--font-stack, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);\n          background: transparent;\n        \">${year}</div>`);\n        \n        // Add click handler\n        $year.on('click', (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          this.currentDate.jy = year;\n          this.showMonthsView();\n        });\n        \n        // Add hover effects\n        $year.hover(\n          function() { \n            if (!$(this).hasClass('selected')) {\n              $(this).css('background-color', '#f8f9fa');\n            }\n          },\n          function() { \n            if (!$(this).hasClass('selected')) {\n              $(this).css('background-color', 'transparent');\n            }\n          }\n        );\n        \n        // Check if current year - use site theme colors like Gregorian\n        if (this.currentDate.jy === year) {\n          $year.addClass('selected').css({\n            'background-color': 'var(--primary, #171717) !important',\n            'color': 'var(--bg-color, white) !important',\n            'font-weight': 'bold !important'\n          });\n        }\n        \n        // Make years outside range faded (like Gregorian calendar)\n        if (year < startYear || year > endYear) {\n          $year.addClass('other-decade').css({\n            'color': 'var(--text-light, #999) !important',\n            'cursor': 'not-allowed !important',\n            'opacity': '0.4 !important'\n          });\n          \n          // Disable click for years outside range\n          $year.off('click').on('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            // Do nothing for years outside range\n          });\n          \n          // Remove hover effect for years outside range\n          $year.off('mouseenter mouseleave');\n        }\n        \n        $yearsGrid.append($year);\n      }\n    }\n    \n    getFirstDayOfMonth(year, month) {\n      // Calculate first day of Jalali month\n      // Convert Jalali date to Gregorian to get the weekday\n      const gregorian = jToG(year, month, 1);\n      const date = new Date(gregorian.gy, gregorian.gm - 1, gregorian.gd);\n      \n      // Convert JavaScript weekday (Sunday=0) to our weekday system (Saturday=0)\n      // JavaScript: Sunday=0, Monday=1, Tuesday=2, Wednesday=3, Thursday=4, Friday=5, Saturday=6\n      // Our system: Saturday=0, Sunday=1, Monday=2, Tuesday=3, Wednesday=4, Thursday=5, Friday=6\n      const jsWeekday = date.getDay(); // 0=Sunday, 6=Saturday\n      return (jsWeekday + 1) % 7; // Convert to our system: Saturday=0, Sunday=1, etc.\n    }\n  }\n\n  // Override Frappe's ControlDate\n  function overrideControlsWhenReady() {\n    const hasControls = frappe && frappe.ui && frappe.ui.form && frappe.ui.form.ControlDate;\n    if (!hasControls) {\n      setTimeout(overrideControlsWhenReady, 50);\n      return;\n    }\n\n    const BaseControlDate = frappe.ui.form.ControlDate;\n\n    class JalaliControlDate extends BaseControlDate {\n      make_input() {\n        // Check if we should use Jalali datepicker based on effective calendar\n        // Store display_calendar in instance for later use\n        this.display_calendar = (EFFECTIVE_CALENDAR && EFFECTIVE_CALENDAR.display_calendar) || \"Jalali\";\n        \n        if (this.display_calendar === \"Gregorian\") {\n          // Use default Frappe datepicker - don't create JalaliDatepicker\n          super.make_input();\n          return;\n        }\n        \n        // Call the parent method to get the standard Frappe input structure\n        super.make_input();\n        \n        // Now replace the air-datepicker with our Jalali datepicker\n        this.replaceWithJalaliDatepicker();\n      }\n      \n      replaceWithJalaliDatepicker() {\n        // Find the input element\n        this.$input = this.$wrapper.find('input');\n        if (!this.$input.length) {\n          this.$input = $(`<input class=\"form-control\" type=\"text\">`);\n          this.$wrapper.append(this.$input);\n        }\n        \n        // Remove any existing air-datepicker instances\n        this.removeAirDatepickerInstances();\n        \n        // Remove any air-datepicker-related attributes and classes\n        this.$input.removeAttr('data-date-format');\n        this.$input.removeAttr('data-alt-input');\n        this.$input.removeAttr('data-alt-format');\n        this.$input.removeClass('datepicker-input');\n        this.$input.removeClass('hasDatepicker');\n        \n        // Make input editable for better UX\n        this.$input.attr('readonly', false);\n        \n        // Apply exact Frappe form control styling to match other fields with higher specificity\n        this.$input.css({\n          'height': 'var(--input-height) !important', // 28px\n          'line-height': 'var(--input-height) !important', // 28px\n          'padding': 'var(--input-padding) !important', // 6px 8px\n          'margin': '0 !important',\n          'vertical-align': 'top !important',\n          'box-sizing': 'border-box !important',\n          'background-color': 'var(--control-bg) !important',\n          'border': '1px solid var(--border-color) !important',\n          'border-radius': 'var(--border-radius-sm) !important',\n          'font-size': 'var(--text-base) !important',\n          'font-weight': 'var(--font-weight-regular) !important',\n          'color': 'var(--text-color) !important',\n          'position': 'relative !important',\n          'z-index': '1 !important',\n          'display': 'block !important',\n          'width': '100% !important'\n        });\n        \n        // Fix the control-input-wrapper to match other fields\n        const $controlInputWrapper = this.$wrapper.find('.control-input-wrapper');\n        if ($controlInputWrapper.length) {\n          $controlInputWrapper.css({\n            'margin': '0 !important',\n            'padding': '0 !important',\n            'vertical-align': 'top !important',\n            'display': 'block !important',\n            'position': 'relative !important'\n          });\n        }\n        \n        // Fix the control-input to match other fields\n        const $controlInput = this.$wrapper.find('.control-input');\n        if ($controlInput.length) {\n          $controlInput.css({\n            'margin': '0 !important',\n            'padding': '0 !important',\n            'vertical-align': 'top !important',\n            'display': 'block !important',\n            'position': 'relative !important',\n            'height': 'var(--input-height) !important',\n            'line-height': 'var(--input-height) !important'\n          });\n        }\n        \n        // Ensure wrapper styling matches other fields with higher specificity\n        this.$wrapper.css({\n          'margin': '0 !important',\n          'padding': '0 !important',\n          'vertical-align': 'top !important',\n          'display': 'block !important',\n          'position': 'relative !important',\n          'align-items': 'flex-start !important'\n        });\n        \n        // Ensure form column alignment with higher specificity\n        const $formColumn = this.$input.closest('.form-column');\n        if ($formColumn.length) {\n          $formColumn.css({\n            'vertical-align': 'top !important',\n            'display': 'flex !important',\n            'flex-direction': 'column !important',\n            'margin': '0 !important',\n            'padding': '0 !important',\n            'align-items': 'stretch !important',\n            'justify-content': 'flex-start !important'\n          });\n        }\n        \n        // Target the specific form section to ensure proper alignment\n        const $formSection = this.$input.closest('.form-section');\n        if ($formSection.length) {\n          $formSection.css({\n            'display': 'flex !important',\n            'flex-direction': 'row !important',\n            'align-items': 'flex-start !important'\n          });\n        }\n        \n        // Remove any existing air-datepicker instances\n        this.removeAirDatepickerInstances();\n        \n        // Create Jalali datepicker\n        this.jalaliDatepicker = new JalaliDatepicker(this.$input[0], this);\n        \n        // Fix alignment after datepicker creation\n        this.fixFieldAlignment();\n      }\n      \n      fixFieldAlignment() {\n        // Ensure the entire field structure matches other fields\n        const $formGroup = this.$wrapper.find('.form-group');\n        if ($formGroup.length) {\n          $formGroup.css({\n            'margin-bottom': '0 !important',\n            'padding': '0 !important',\n            'vertical-align': 'top !important',\n            'display': 'block !important'\n          });\n        }\n        \n        // Ensure the clearfix div doesn't affect alignment\n        const $clearfix = this.$wrapper.find('.clearfix');\n        if ($clearfix.length) {\n          $clearfix.css({\n            'margin': '0 !important',\n            'padding': '0 !important',\n            'vertical-align': 'top !important',\n            'display': 'block !important'\n          });\n        }\n        \n        // Ensure the control-label doesn't affect alignment\n        const $controlLabel = this.$wrapper.find('.control-label');\n        if ($controlLabel.length) {\n          $controlLabel.css({\n            'margin': '0 !important',\n            'padding': '0 !important',\n            'vertical-align': 'top !important',\n            'display': 'block !important',\n            'line-height': 'normal !important'\n          });\n        }\n        \n        // Ensure the help span doesn't affect alignment\n        const $help = this.$wrapper.find('.help');\n        if ($help.length) {\n          $help.css({\n            'margin': '0 !important',\n            'padding': '0 !important',\n            'vertical-align': 'top !important',\n            'display': 'block !important'\n          });\n        }\n        \n        // Ensure the help-box doesn't affect alignment\n        const $helpBox = this.$wrapper.find('.help-box');\n        if ($helpBox.length) {\n          $helpBox.css({\n            'margin': '0 !important',\n            'padding': '0 !important',\n            'vertical-align': 'top !important',\n            'display': 'block !important'\n          });\n        }\n      }\n      \n      removeAirDatepickerInstances() {\n        // Remove any existing air-datepicker instances\n        if (this.datepicker) {\n          try {\n            this.datepicker.destroy();\n            this.datepicker = null;\n          } catch(e) {\n            console.log('Error destroying air-datepicker:', e);\n          }\n        }\n        \n        // Remove air-datepicker-related DOM elements\n        $('.air-datepicker').remove();\n        $('.datepicker-input').removeClass('datepicker-input');\n        $('.hasDatepicker').removeClass('hasDatepicker');\n        \n        // Remove any datepicker icons or buttons\n        $('.datepicker-icon').remove();\n        $('.datepicker-btn').remove();\n        \n        // Clear any datepicker-related data\n        if (this.$input && this.$input.length) {\n          this.$input.removeData('datepicker');\n        }\n        \n        // Remove any air-datepicker event listeners\n        if (this.$input && this.$input.length) {\n          this.$input.off('.datepicker');\n        }\n        \n        console.log('Air-datepicker instances removed for field:', this.df.fieldname);\n      }\n\n      set_formatted_input(value) {\n        try {\n          // Check display calendar from instance or global\n          const display_calendar = this.display_calendar || \n            (EFFECTIVE_CALENDAR && EFFECTIVE_CALENDAR.display_calendar) || \n            \"Jalali\";\n          \n          // Check if we should use Gregorian calendar (no conversion)\n          if (display_calendar === \"Gregorian\") {\n            // Use default Frappe behavior - show Gregorian dates as-is\n            // Don't convert to Jalali\n            console.log('set_formatted_input - Using Gregorian calendar, no conversion');\n            return super.set_formatted_input(value);\n          }\n\n          // Jalali calendar - convert Gregorian to Jalali for display\n          const r = super.set_formatted_input(value);\n\n          // Convert Gregorian to Jalali for display (only when Jalali is enabled)\n          if (value) {\n            console.log('set_formatted_input - Input value:', value, 'Display calendar:', display_calendar);\n            \n            // Parse the date more carefully\n            let gregorianDate;\n            if (typeof value === 'string') {\n              // Handle different date formats\n              if (value.includes('T')) {\n                gregorianDate = new Date(value);\n              } else if (value.includes('-')) {\n                gregorianDate = new Date(value + 'T00:00:00');\n              } else {\n                gregorianDate = new Date(value);\n              }\n            } else {\n              gregorianDate = new Date(value);\n            }\n            \n            console.log('set_formatted_input - Parsed date:', gregorianDate);\n            \n            if (!isNaN(gregorianDate.getTime())) {\n              const jalali = gToJ(gregorianDate);\n              const jalaliStr = formatJalaliDate(jalali.jy, jalali.jm, jalali.jd);\n              console.log('set_formatted_input - Jalali:', jalali, 'String:', jalaliStr);\n              this.$input.val(jalaliStr);\n              \n              // Update datepicker\n              if (this.jalaliDatepicker) {\n                this.jalaliDatepicker.updateDisplay();\n              }\n            } else {\n              console.log('set_formatted_input - Invalid date, keeping original value');\n            }\n          }\n\n          return r;\n        } catch(e) {\n          console.log('set_formatted_input error:', e);\n          return super.set_formatted_input(value);\n        }\n      }\n    }\n\n    frappe.ui.form.ControlDate = JalaliControlDate;\n    console.log(\"ControlDate patched for Jalali\");\n  }\n\n  // Function to remove all existing air-datepicker instances from the page\n  function removeAllAirDatepickerInstances() {\n    // Remove all air-datepicker calendars\n    $('.air-datepicker').remove();\n    \n    // Remove air-datepicker classes and attributes from all inputs\n    $('input.datepicker-input, input.hasDatepicker').each(function() {\n      $(this).removeClass('datepicker-input hasDatepicker');\n      $(this).removeAttr('data-date-format');\n      $(this).removeAttr('data-alt-input');\n      $(this).removeAttr('data-alt-format');\n      $(this).removeData('datepicker');\n      \n      // Remove event listeners\n      $(this).off('.datepicker');\n    });\n    \n    // Remove any datepicker icons or buttons\n    $('.datepicker-icon, .datepicker-btn').remove();\n    \n    // Remove any air-datepicker instances from global scope\n    if (window.Datepicker) {\n      try {\n        // Try to destroy all instances\n        Object.keys(window.Datepicker.instances || {}).forEach(key => {\n          try {\n            window.Datepicker.instances[key].destroy();\n          } catch(e) {\n            console.log('Error destroying air-datepicker instance:', e);\n          }\n        });\n      } catch(e) {\n        console.log('Error accessing air-datepicker instances:', e);\n      }\n    }\n    \n    console.log('Removed all air-datepicker instances from the page');\n  }\n  \n  // Remove existing air-datepicker instances immediately\n  removeAllAirDatepickerInstances();\n  \n  // Also remove them periodically to catch any dynamically created ones\n  setInterval(removeAllAirDatepickerInstances, 1000);\n\n  // Start overriding\n  overrideControlsWhenReady();\n\n  // Override Fiscal Year defaults to Jalali year boundaries when enabled\n  try {\n    frappe.ui.form.on('Fiscal Year', {\n      onload: function(frm) {\n        try {\n          if (!frm.doc.__islocal) return; // only for new docs\n          if (!jalaliEnabled) return;\n          if (EFFECTIVE_CALENDAR && EFFECTIVE_CALENDAR.display_calendar === 'Gregorian') return;\n\n          // If user already set a start date, don't override\n          if (frm.doc.year_start_date) return;\n\n          // Determine current Jalali year from today\n          const todayG = new Date();\n          const todayJ = gToJ(todayG);\n\n          const jy = todayJ.jy;\n          // Start: jy-01-01 (Jalali) => Gregorian\n          const startG = jToG(jy, 1, 1);\n          const startStr = `${startG.gy}-${String(startG.gm).padStart(2,'0')}-${String(startG.gd).padStart(2,'0')}`;\n\n          // End: next jy's 01-01 minus one day\n          const nextStartG = jToG(jy + 1, 1, 1);\n          const nextStartDate = new Date(nextStartG.gy, nextStartG.gm - 1, nextStartG.gd);\n          const endDate = new Date(nextStartDate.getTime() - 24 * 60 * 60 * 1000);\n          const endStr = `${endDate.getFullYear()}-${String(endDate.getMonth()+1).padStart(2,'0')}-${String(endDate.getDate()).padStart(2,'0')}`;\n\n          frm.set_value('year_start_date', startStr);\n          // If not short year, Frappe's handler sets end automatically; force set to Jalali end regardless\n          frm.set_value('year_end_date', endStr);\n        } catch (e) {\n          console.log('Error setting Jalali Fiscal Year defaults:', e);\n        }\n      }\n    });\n  } catch (e) {\n    console.log('Unable to attach Fiscal Year onload override:', e);\n  }\n\n  // Listen for User form calendar_preference changes and refresh page after save\n  // Only refresh if user is editing their own profile (My Settings)\n  try {\n    frappe.ui.form.on('User', {\n      after_save: function(frm) {\n        // Check if calendar_preference field exists and if user is editing their own profile\n        if (frm.doc.calendar_preference !== undefined && \n            frm.doc.name === frappe.session.user) {\n          console.log('User calendar_preference changed to:', frm.doc.calendar_preference);\n          console.log('Reloading page to apply new calendar settings...');\n          // Reload page to apply new calendar settings\n          setTimeout(function() {\n            window.location.reload();\n          }, 500);\n        }\n      }\n    });\n  } catch (e) {\n    console.log('Unable to attach User form handler:', e);\n  }\n\n})();", "(async function() {\n  // Check if Jalali calendar is enabled\n  let jalaliEnabled = false;\n  \n  try {\n    const result = await frappe.call({ method: \"persian_calendar.jalali_support.api.is_jalali_enabled\" });\n    jalaliEnabled = result && result.message;\n    console.log(\"Jalali calendar enabled:\", jalaliEnabled);\n  } catch(e) {\n    console.log(\"Error checking Jalali settings:\", e);\n    jalaliEnabled = false;\n  }\n\n  if (!jalaliEnabled) {\n    console.log(\"Jalali calendar is disabled, skipping formatters\");\n    return;\n  }\n\n  // Get effective calendar settings\n  let EFFECTIVE_CALENDAR = {\n    display_calendar: \"Jalali\",\n    week_start: 6,\n    week_end: 5\n  };\n  \n  try {\n    const r = await frappe.call({ method: \"persian_calendar.jalali_support.api.get_effective_calendar\" });\n    if (r && r.message) {\n      EFFECTIVE_CALENDAR = r.message;\n      console.log(\"Effective calendar settings in formatters:\", EFFECTIVE_CALENDAR);\n    }\n  } catch(e) {\n    console.log(\"Error fetching effective calendar in formatters:\", e);\n  }\n\n  function g2j_str(value) {\n    try {\n      // Parse as UTC to avoid TZ shifts and month off-by-one\n      const d = new Date(value + (value.length === 10 ? 'T00:00:00Z' : 'Z'));\n      if (isNaN(d)) return value;\n      const j = toJalali(d.getUTCFullYear(), d.getUTCMonth()+1, d.getUTCDate());\n      return `${j.jy}-${String(j.jm).padStart(2,\"0\")}-${String(j.jd).padStart(2,\"0\")}`;\n    } catch(e) {\n      return value;\n    }\n  }\n\n  // Helper function to check if we should convert to Jalali\n  function shouldConvertToJalali() {\n    return EFFECTIVE_CALENDAR && EFFECTIVE_CALENDAR.display_calendar === \"Jalali\";\n  }\n\n  // Global datetime helpers \u2192 force Jalali display in UI components (lists/reports)\n  const dt = frappe.datetime;\n  const orig_str_to_user = dt.str_to_user?.bind(dt);\n  const orig_str_to_user_with_default = dt.str_to_user_with_default?.bind(dt);\n  const orig_format_date = dt.format_date?.bind(dt);\n  const orig_format_datetime = dt.format_datetime?.bind(dt);\n\n  if (orig_str_to_user) {\n    dt.str_to_user = function(value) {\n      if (!value) return value;\n      \n      // Check if we should convert to Jalali\n      if (!shouldConvertToJalali()) {\n        // Use original function for Gregorian calendar\n        return orig_str_to_user(value);\n      }\n      \n      const is_datetime = typeof value === \"string\" && value.length > 10 && value.includes(\":\");\n      if (is_datetime) {\n        const date = value.slice(0, 10);\n        const time = value.slice(11, 19);\n        return `${g2j_str(date)} ${time}`.trim();\n      }\n      return g2j_str(value);\n    };\n  }\n  if (orig_str_to_user_with_default) {\n    dt.str_to_user_with_default = function(value) {\n      if (!value) return value;\n      \n      // Check if we should convert to Jalali\n      if (!shouldConvertToJalali()) {\n        return orig_str_to_user_with_default(value);\n      }\n      \n      return dt.str_to_user(value);\n    };\n  }\n  if (orig_format_date) {\n    dt.format_date = function(date_str) {\n      // Check if we should convert to Jalali\n      if (!shouldConvertToJalali()) {\n        return orig_format_date(date_str);\n      }\n      return g2j_str(date_str);\n    };\n  }\n  if (orig_format_datetime) {\n    dt.format_datetime = function(value) {\n      if (!value) return value;\n      \n      // Check if we should convert to Jalali\n      if (!shouldConvertToJalali()) {\n        return orig_format_datetime(value);\n      }\n      \n      const date = value.slice(0, 10);\n      const time = value.slice(11, 19) || \"\";\n      return `${g2j_str(date)} ${time}`.trim();\n    };\n  }\n\n  // Store original formatters\n  const orig_date_formatter = frappe.form.formatters.date;\n  const orig_datetime_formatter = frappe.form.formatters.datetime;\n\n  frappe.form.formatters.date = function(value, df, options, doc) {\n    if (!value) return value;\n    \n    // Check if we should convert to Jalali\n    if (!shouldConvertToJalali()) {\n      // Use original formatter for Gregorian calendar\n      if (orig_date_formatter) {\n        return orig_date_formatter(value, df, options, doc);\n      }\n      return value;\n    }\n    \n    return g2j_str(value);\n  };\n  \n  frappe.form.formatters.datetime = function(value, df, options, doc) {\n    if (!value) return value;\n    \n    // Check if we should convert to Jalali\n    if (!shouldConvertToJalali()) {\n      // Use original formatter for Gregorian calendar\n      if (orig_datetime_formatter) {\n        return orig_datetime_formatter(value, df, options, doc);\n      }\n      return value;\n    }\n    \n    const d = new Date(value);\n    if (isNaN(d)) return value;\n    const j = toJalali(d.getFullYear(), d.getMonth()+1, d.getDate());\n    const time = value.slice(11, 19) || \"\";\n    return `${j.jy}-${String(j.jm).padStart(2,\"0\")}-${String(j.jd).padStart(2,\"0\")} ${time}`;\n  };\n})();\n\n\n", "// Auto-refresh functionality for Jalali Settings\n// Wait for frappe to be available\n(function() {\n  function initAutoRefresh() {\n    if (typeof frappe !== 'undefined' && frappe.ui && frappe.ui.form) {\n      // Listen for form events on Jalali Settings\n      frappe.ui.form.on('Jalali Settings', {\n        after_save: function(frm) {\n          // Silently reload after save for Jalali Settings (no message)\n          setTimeout(function() {\n            window.location.reload();\n          }, 100);\n        }\n      });\n    } else {\n      // Retry after a short delay\n      setTimeout(initAutoRefresh, 100);\n    }\n  }\n\n  // Start initialization\n  initAutoRefresh();\n})();\n"],
  "mappings": "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",
  "names": ["toJalali", "toGregorian"]
}
